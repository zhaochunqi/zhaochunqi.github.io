<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 从零开始将树莓派打造成家用下载机【一】 网络配置篇 · Alex Coding</title><meta name="description" content="从零开始将树莓派打造成家用下载机【一】 网络配置篇 - Alex Zhao"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/121189047" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/zhaochunqi" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">从零开始将树莓派打造成家用下载机【一】 网络配置篇</h1><div class="post-time">Apr 17, 2016</div><div class="post-content"><p>本篇讲介绍一下树莓派基本的网络配置，使其能够在公网正常访问。<br><a id="more"></a></p>
<p><img src="http://harchiko.qiniudn.com/Pi_3_Model_B.png" alt="http://harchiko.qiniudn.com/Pi_3_Model_B.png"></p>
<h3 id="烧录 micro-sd 卡"><a href="# 烧录 micro-sd 卡" class="headerlink" title="烧录 micro sd 卡"></a>烧录 micro sd 卡 </h3><p> 具体操作可查看官方<a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md" target="_blank" rel="external">https://www.raspberrypi.org/documentation/installation/installing-images/README.md</a>，比较简单，不详述。</p>
<h3 id="配置 IP 地址"><a href="# 配置 IP 地址" class="headerlink" title="配置 IP 地址"></a>配置 IP 地址 </h3><p> 烧录好之后插上 SD 卡，接好网线启动树莓派，看到树莓派灯正常亮系统应该就算启动完成了。</p>
<ol>
<li>进入路由器后台, 打开 DHCP 服务，查看树莓派的 ip 地址，将其修改为固定 ip 地址后重启路由器(我的为 192.168.0.169)。</li>
<li>使用 <code>ssh pi@192.168.0.169</code>登录树莓派（Mac/Linux 下直接使用 Terminal, Windows 下可使用 Xshell）</li>
</ol>
<h3 id="配置公网访问"><a href="# 配置公网访问" class="headerlink" title="配置公网访问"></a>配置公网访问 </h3><h3 id="路由器"><a href="# 路由器" class="headerlink" title="路由器"></a> 路由器</h3><ul>
<li>DMZ 主机配置 <br> 在路由器中，配置中找到 DMZ 主机选项，将其设置为树莓派的 ip。</li>
</ul>
<h3 id="SSH 配置"><a href="#SSH 配置" class="headerlink" title="SSH 配置"></a>SSH 配置 </h3><h4 id="密码修改"><a href="# 密码修改" class="headerlink" title="密码修改"></a> 密码修改 </h4><pre><code> 使用命令 `passwd pi` 修改 pi 的密码。建议密码修改强度足够强，因为这台主机会暴露在公网。
</code></pre><h4 id="SSH 端口修改"><a href="#SSH 端口修改" class="headerlink" title="SSH 端口修改"></a>SSH 端口修改 </h4><pre><code> 出于同样的安全考虑，修改 ssh 端口
</code></pre><ul>
<li>修改配置文件 <code>vi /etc/ssh/sshd_config</code> 将 ssh 端口修改为 xxxx(你希望的端口), 这里我设定的是 1213。</li>
<li>重启 SSH 服务，<code>sudo service ssh restart</code></li>
</ul>
<h4 id="查看本地 IP 是否能从公网访问"><a href="# 查看本地 IP 是否能从公网访问" class="headerlink" title="查看本地 IP 是否能从公网访问"></a>查看本地 IP 是否能从公网访问</h4><blockquote>
<p>在国内，因为 ipv4 地址不够用或者一些其他原因，你所使用的 ip 可能是电信分配的局域网的 ip，这时候你就需要找电信客服说一下你需要公网 ip 让他们帮你改回来。</p>
</blockquote>
<p>这里通过 telnet 服务看一下是否当前分配的是公网 ip</p>
<ol>
<li><strong>查看本机的公网 ip</strong><br>使用命令 <code>curl ifconfig.me</code>, 或者直接在百度中搜索 ip。</li>
<li><strong>本地查看 SSH 服务端口号是否更改过来 </strong> <code>telnet 192.168.0.169 1213</code><br>(<code>#xxxx</code> 指的是端口号)</li>
<li><strong>通过公网查看</strong> 通过第一步查看到的 ip 来从公网访问<code>telnet xxx.xxx.xxx 1213</code><br>(这里使用公网 ip）如果能够正常运行的话则证明此树莓派已经运行在公网。</li>
</ol>
<p>这样 ssh 登录命令变为 <code>ssh pi@xxx.xxx.xxx -p 1213</code> （指定端口）</p>
<h4 id="将本地 ip 与域名绑定"><a href="# 将本地 ip 与域名绑定" class="headerlink" title="将本地 ip 与域名绑定"></a>将本地 ip 与域名绑定 </h4><p> 因为家庭宽带的 ip 是不固定的，如果使用 ip 进行连接的话每次都要先获取到机器的当前 ip 才能进行 ssh 登录，这里我们将 ip 地址绑定到二级域名上。</p>
<p>按照此 repo: <a href="https://github.com/zhaochunqi/change_my_ip_on_dnspod" target="_blank" rel="external">https://github.com/zhaochunqi/change_my_ip_on_dnspod</a> 中 README 进行相应配置。</p>
<ol>
<li>clone 这个 repo， 在 Dnspod 中获取到 APIKEY，以及响应的二级域名需要的参数。</li>
<li>修改库中的 change_my_ip_on_dnspod.sh <code>Shell</code>脚本。</li>
<li>使用命令 <code>chmod +x change_my_ip_on_dnspod.sh</code> 添加脚本的可执行权限。</li>
<li>运行 ./change_my_ip_on_dnspod.sh 查看返回值, 得到如下图的结果即为成功。<img src="http://harchiko.qiniudn.com/Screen%20Shot%202016-04-18%20at%2012.13.26%20AM.png" alt="http://harchiko.qiniudn.com/Screen%20Shot%202016-04-18%20at%2012.13.26%20AM.png"></li>
<li>登录树莓派系统 <code>crontab -e</code>在末尾添加 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># every 20 mins</span></span><br><span class="line">*/20 * * * * ./path/to/change_ip_4_pi.sh</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><code>path/to/change_ip_4_pi.sh</code> 替换为你的真实地址。</p>
<p>至此，你能从你刚刚绑定的二级域名直接访问到你的树莓派:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh pi@haha.mydomain.com -p 1213</span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2016/04/22/raspberry-pi-as-nas-server2/" class="prev">PREV</a><a href="/2016/04/12/vim-plugin-gist-vim/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'blog-zhaochunqi';
var disqus_identifier = '2016/04/17/raspberry-pi-as-nas-server/';
var disqus_title = '从零开始将树莓派打造成家用下载机【一】 网络配置篇';
var disqus_url = 'http://blog.zhaochunqi.com/2016/04/17/raspberry-pi-as-nas-server/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blog-zhaochunqi.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.zhaochunqi.com">Alex Zhao</a>, unless otherwise noted.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-42448552-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "cfffa20d202ba9f4f0d6257e1cc94ea6";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>